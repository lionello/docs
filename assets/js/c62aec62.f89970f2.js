"use strict";(self.webpackChunkplatformatic_oss_website=self.webpackChunkplatformatic_oss_website||[]).push([[80135],{9981:(e,a,o)=>{o.r(a),o.d(a,{assets:()=>r,contentTitle:()=>s,default:()=>h,frontMatter:()=>i,metadata:()=>c,toc:()=>d});var n=o(85893),t=o(11151);const i={},s="Deploying on AWS Lambda",c={id:"guides/deploying-on-lambda",title:"Deploying on AWS Lambda",description:"It is possible to deploy Platformatic applications to AWS Lambda",source:"@site/versioned_docs/version-1.21.1/guides/deploying-on-lambda.md",sourceDirName:"guides",slug:"/guides/deploying-on-lambda",permalink:"/docs/1.21.1/guides/deploying-on-lambda",draft:!1,unlisted:!1,editUrl:"https://github.com/platformatic/oss/edit/main/versioned_docs/version-1.21.1/guides/deploying-on-lambda.md",tags:[],version:"1.21.1",frontMatter:{}},r={},d=[{value:"Avoiding cold start",id:"avoiding-cold-start",level:2},{value:"Caching the DB schema",id:"caching-the-db-schema",level:3},{value:"Provisioned concurrency",id:"provisioned-concurrency",level:3}];function l(e){const a={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",p:"p",pre:"pre",...(0,t.a)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(a.h1,{id:"deploying-on-aws-lambda",children:"Deploying on AWS Lambda"}),"\n",(0,n.jsxs)(a.p,{children:["It is possible to deploy Platformatic applications to ",(0,n.jsx)(a.a,{href:"https://aws.amazon.com/lambda/",children:"AWS Lambda"}),"\nby leveraging ",(0,n.jsx)(a.a,{href:"https://github.com/fastify/aws-lambda-fastify",children:(0,n.jsx)(a.code,{children:"@fastify/aws-lambda"})}),"."]}),"\n",(0,n.jsxs)(a.p,{children:["Once you set up your Platformatic DB application, such as following\n",(0,n.jsx)(a.a,{href:"/docs/1.21.1/getting-started/quick-start-guide",children:"our tutorial"}),", you can create a\n",(0,n.jsx)(a.code,{children:"server.mjs"})," file as follows:"]}),"\n",(0,n.jsx)(a.pre,{children:(0,n.jsx)(a.code,{className:"language-js",children:"import awsLambdaFastify from '@fastify/aws-lambda'\nimport { buildServer } from '@platformatic/db'\n\nconst app = await buildServer('./platformatic.db.json')\n// You can use the same approach with both Platformatic DB and\n// and service\n// const app = await buildServer('./platformatic.service.json')\n\n// The following also work for Platformatic Service applications\n// import { buildServer } from '@platformatic/service'\nexport const handler = awsLambdaFastify(app)\n\n// Loads the Application, must be after the call to `awsLambdaFastify`\nawait app.ready()\n"})}),"\n",(0,n.jsx)(a.p,{children:"This would be the entry point for your AWS Lambda function."}),"\n",(0,n.jsx)(a.h2,{id:"avoiding-cold-start",children:"Avoiding cold start"}),"\n",(0,n.jsx)(a.h3,{id:"caching-the-db-schema",children:"Caching the DB schema"}),"\n",(0,n.jsxs)(a.p,{children:["If you use Platformatic DB, you want to turn on the ",(0,n.jsx)(a.code,{children:"schemalock"}),"\n",(0,n.jsx)(a.a,{href:"/docs/1.21.1/reference/db/configuration",children:"configuration"})," to cache the schema\ninformation on disk."]}),"\n",(0,n.jsxs)(a.p,{children:["Set the ",(0,n.jsx)(a.code,{children:"db.schemalock"})," configuration to ",(0,n.jsx)(a.code,{children:"true"}),", start the application,\nand a ",(0,n.jsx)(a.code,{children:"schema.lock"})," file should appear. Make sure to commit that file and\ndeploy your lambda."]}),"\n",(0,n.jsx)(a.h3,{id:"provisioned-concurrency",children:"Provisioned concurrency"}),"\n",(0,n.jsxs)(a.blockquote,{children:["\n",(0,n.jsxs)(a.p,{children:["Since ",(0,n.jsx)(a.a,{href:"https://aws.amazon.com/blogs/compute/using-node-js-es-modules-and-top-level-await-in-aws-lambda/",children:"AWS Lambda now enables the use of ECMAScript (ES) modules"})," in Node.js 14 runtimes,\nyou could lower the cold start latency when used with ",(0,n.jsx)(a.a,{href:"https://aws.amazon.com/blogs/compute/new-for-aws-lambda-predictable-start-up-times-with-provisioned-concurrency/",children:"Provisioned Concurrency"}),"\nthanks to the top-level await functionality. (Excerpt taken from ",(0,n.jsx)(a.a,{href:"https://github.com/fastify/aws-lambda-fastify#lower-cold-start-latency",children:(0,n.jsx)(a.code,{children:"@fastify/aws-lambda"})}),")"]}),"\n"]})]})}function h(e={}){const{wrapper:a}={...(0,t.a)(),...e.components};return a?(0,n.jsx)(a,{...e,children:(0,n.jsx)(l,{...e})}):l(e)}},11151:(e,a,o)=>{o.d(a,{Z:()=>c,a:()=>s});var n=o(67294);const t={},i=n.createContext(t);function s(e){const a=n.useContext(i);return n.useMemo((function(){return"function"==typeof e?e(a):{...a,...e}}),[a,e])}function c(e){let a;return a=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:s(e.components),n.createElement(i.Provider,{value:a},e.children)}}}]);